swagger: "2.0"
info:
  version: "1.0.0"
  title: "Exports de JDD concernant la biodiversité"
  description: "Export de vos jeux de données GéoNature aux formats geojson, csv et shapefile"
  contact:
    name: API Support
    url: https://github.com/PnX-SI/GeoNature/issues
    email: geonature@ecrins-parcnational.fr
  license:
    name: GNU General Public License v3.0
    url: https://raw.githubusercontent.com/PnX-SI/GeoNature/master/LICENSE
externalDocs:
  description: "Find out more about GéoNature"
  url: "http://geonature.fr"
servers:
  - url: http://{api_endpoint}/{api_url}/
    description: Development server
    variables:
      api_endpoint: {{API_ENDPOINT}}
      api_url: {{API_URL}}
  # - url: http://{api_endpoint}/{api_url}/
  #   description: Demo server
  #   variables:
  #     api_endpoint: demo.geonature.fr/geonature/api
  #     api_url: exports
schemes:
  - http
security:
  - bearerAuth: []
produces:
  - application/json
consumes:
  - application/json
components:
  schemas:
    Export:
      type: object
      properties:
        id:
          type: integer
          minimum: 1
        label:
          type: string
        schema_name:
          type: string
        view_name:
          type: string
      required:
        - id
    securitySchemes:
      bearerAuth:
        type: http
        scheme: bearer
        bearerFormat: JWT
paths:
  /{{API_URL}}/:
    get:
      description: Returns all exports from the system that the user has access to
      responses:
        '200':
          description: A list of exports
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Export'
        '404':
          description: No configured exports
        '400':
          description: Unexpected usage
        '403':
          description: Unauthenticated
  /{{API_URL}}/{id}/{format}:
    get:
      description: Returns the format-specified data from the export the user has access to
      parameters:
        - name: id
          in: path
          description: The export ID
          required: true
          type: integer
        - name: format
          in: path
          description: |
            The data format:
              - json: w/o geographic information
              - csv: w/o geographic information
              - shp: with geographic information
          enum:
            - json
            - csv
            - shp
          required: true
          type: string
      responses:
        '200':
          description: A file
          content:
            'application/json': {}
            'text/csv': {}
            'application/zip': {}
          examples:
            application/json: |
              [{
                "obsMeth": "23",                                           # some comment on this particular field
                "preuvNum": "",
                "permIdGrp": "51bd7642-512f-49aa-a917-cd2fcb8da1e3",
                "dateFin": "2017-01-01 00:00:00",
                "obsId": "Administrateur test",
                "statObs": "Pr",
                "statSource": null,
                "versionTAXREF": "Taxref V11.0",
                "ocMethDet": "Autre m\u00e9thode de d\u00e9termination",
                "ocEtatBio": "1",
                "denbrMin": 1,
                "denbrMax": 1,
                "dateDebut": "2017-01-01 00:00:00",
                "WKT": "POINT(6.5 44.85)",
                "cdRef": 351,
                "heureFin": "12:05:02",
                "ocStatBio": "1",
                "detNomOrg": "NSP",
                "ocStade": "4",
                "obsCtx": "Exemple test",
                "jddMetadonneeDEEId": "4d331cae-65e4-4948-b0b2-a11bc5bb46c2",
                "idOrigine": "5ce538fd-8143-4810-a6c8-7a98cf14f879",
                "preuvNoNum": "Poils de plumes",
                "detId": "Th\u00e9o",
                "jddId": "4d331cae-65e4-4948-b0b2-a11bc5bb46c2",
                "typDenbr": "Co",
                "preuveOui": "0",
                "permId": "5ce538fd-8143-4810-a6c8-7a98cf14f879",
                "datedet": "2017-01-01 00:00:00",
                "diffusionNiveauPrecision": "0",
                "altMax": 1565,
                "typGrp": "OBS",
                "comment": "Autre test",
                "ocBiogeo": "0",
                "obsNomOrg": "Autre",
                "cdNom": 351,
                "ocNat": "1",
                "jddCode": "Contact al\u00e9atoire tous r\u00e8gnes confondus",
                "orgGestDat": "NSP",
                "methGrp": "Relev\u00e9",
                "altMin": 1500,
                "ocSex": "2",
                "nomCite": "Grenouille rousse",
                "dSPublique": "NSP",
                "objDenbr": "IND",
                "heureDebut": "12:05:02",
                "refBiblio": null,
                "natObjGeo": "In"
              }, {
                "...": "..."
              }]
            text/csv: |
              permId,statObs,nomCite,dateDebut,dateFin,heureDebut,heureFin,altMax,altMin,cdNom,cdRef,versionTAXREF,datedet,comment,dSPublique,jddMetadonneeDEEId,statSource,diffusionNiveauPrecision,idOrigine,jddCode,jddId,refBiblio,obsMeth,ocEtatBio,ocNat,ocSex,ocStade,ocBiogeo,ocStatBio,preuveOui,ocMethDet,preuvNum,preuvNoNum,obsCtx,permIdGrp,methGrp,typGrp,denbrMax,denbrMin,objDenbr,typDenbr,obsId,obsNomOrg,detId,detNomOrg,orgGestDat,WKT,natObjGeo
              "5ce538fd-8143-4810-a6c8-7a98cf14f879","Pr","Grenouille rousse","2017-01-01 00:00:00","2017-01-01 00:00:00","12:05:02","12:05:02","1565","1500","351","351","Taxref V11.0","2017-01-01 00:00:00","Autre test","NSP","4d331cae-65e4-4948-b0b2-a11bc5bb46c2","","0","5ce538fd-8143-4810-a6c8-7a98cf14f879","Contact aléatoire tous règnes confondus","4d331cae-65e4-4948-b0b2-a11bc5bb46c2","","23","1","1","2","4","0","1","0","Autre méthode de détermination","","Poils de plumes","Exemple test","51bd7642-512f-49aa-a917-cd2fcb8da1e3","Relevé","OBS","1","1","IND","Co","Administrateur test","Autre","Théo","NSP","NSP","POINT(6.5 44.85)","In"
              "9f42bc38-2cae-4bb9-af2c-f76ef732b571","Pr","Lynx Boréal","2017-01-01 00:00:00","2017-01-01 00:00:00","12:05:02","12:05:02","1565","1500","60612","60612","Taxref V11.0","2017-01-01 00:00:00","Test","NSP","4d331cae-65e4-4948-b0b2-a11bc5bb46c2","","0","9f42bc38-2cae-4bb9-af2c-f76ef732b571","Contact aléatoire tous règnes confondus","4d331cae-65e4-4948-b0b2-a11bc5bb46c2","","23","1","1","2","2","0","1","0","Autre méthode de détermination","","Poil","Exemple test","51bd7642-512f-49aa-a917-cd2fcb8da1e3","Relevé","OBS","5","5","IND","Co","Administrateur test","Autre","Gil","NSP","NSP","POINT(6.5 44.85)","In"
              "eb67d3a2-c7f2-4340-820c-5c710b45bdf0","Pr","Ablette","2017-01-08 00:00:00","2017-01-08 00:00:00","20:00:00","23:00:00","1600","1600","67111","67111","Taxref V11.0","2017-01-08 00:00:00","Troisieme test","NSP","4d331cae-65e4-4948-b0b2-a11bc5bb46c2","","0","eb67d3a2-c7f2-4340-820c-5c710b45bdf0","Contact aléatoire tous règnes confondus","4d331cae-65e4-4948-b0b2-a11bc5bb46c2","","23","1","1","2","3","0","1","0","Autre méthode de détermination","","Poils de plumes","Autre exemple test","cb0b1e2e-9cb4-4714-baa8-9c293059a423","Relevé","OBS","1","1","IND","Co","Administrateur test","Autre","Donovan","NSP","NSP","POINT(6.5 44.85)","In"
        '404':
          description: No configured export | Empty dataset
        '400':
          description: Unexpected usage
        '403':
          description: Unauthenticated | Insufficient rights
