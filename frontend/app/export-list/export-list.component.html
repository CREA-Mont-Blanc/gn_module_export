<div id="all" class="container-fluid">
  <form [formGroup]="modalForm" class="modal-content">
    <div class="row row-m">
      <div class="container card">
        <div id="title">
          <h2>EXPORTS</h2>
          <hr align="left" width="75%">
        </div>
        <div id="textPresentation">
          <p>Voici la liste des exports disponibles. Ces exports ont été programmés par l'administrateur de GeoNature.</p>
        </div>
        <div id="textPresentation">
          <p>Pour modifier cette liste ou disposer d'exports supplémentaires, veuillez contacter le service administrateur.</p>
        </div>
        <!-- Liste des exports disponibles au téléchargement -->
        <div>
          <ngx-datatable
            [loadingIndicator]="loadingIndicator"
            [rows]="exports$ | async"
            [columnMode]="'flex'"
            [rowHeight]="'auto'"
            [limit]="6"
            [reorderable]="true">
              <ngx-datatable-column name="Nom export" prop="label" [flexGrow]="1">
                <ng-template let-value="value" ngx-datatable-cell-template>
                  {{value}}
                </ng-template>
              </ngx-datatable-column>
              <ngx-datatable-column name="Description" prop="desc" [flexGrow]="2">
                <ng-template let-value="value" ngx-datatable-cell-template>
                  {{value}}
                </ng-template>
              </ngx-datatable-column>
              <ngx-datatable-column name="Actions" prop="id" [flexGrow]="3">
                <ng-template let-value="value" ngx-datatable-cell-template>
                  <button id="api_id_{{value}}"
                          class="btn btn-outline-warning"
                          (click)=openAPIDocumentation()>API</button>
                  <button id="{{value}}" type="submit"
                          class="btn btn-outline-primary"
                          [disabled]="!buttonDisabled"
                          (click)="selectFormat(value)">Télécharger</button>
                </ng-template>
              </ngx-datatable-column>
          </ngx-datatable>
        </div>
        <div id="checkLicence">
          <label for="licence">Accepter la licence</label>
          <input type="checkbox" class="form-control" id="licence" (click)="follow()" required/>
        </div>

        <div id="readlicence">
          <a href="external_assets/exports/licence.pdf" download="licence.pdf" type="application/octet-stream">
            <input type="button" class="btn btn-outline-secondary btn-sm pull-right" value="Lire la licence">
          </a>
        </div>
      </div>
    </div>
    <!-- Modal Téléchargement Popup-->
    <ng-template #content let-c="close" let-d="dismiss">

      <!-- Modal content-->
      <div class="modal-header">
          <h4 class="modal-title">Configuration de l'export</h4>
      </div>

      <div class="modal-body">
        <!-- Formulaire pour le choix des standards et des formats de téléchargement des fichiers -->
        <br>
        <ul> <li> Choisir un format </li> </ul>
        <select class="form-control" id="formatSelection"
                formControlName="formatSelection" required autocomplete="off"
                (change)="downloading=false">
                <option value="csv">CSV</option>
                <option value="json">JSON</option>
                <option value="shp" [disabled]="!_export.geometry_field">SHP</option>
                <!-- <option value="rdf" [disabled]="true">RDF</option> -->
        </select>
        <!-- Affichage d'une barre de progression lors du téléchargement du fichier -->
        <div *ngIf="downloading">
          <download-progress-bar></download-progress-bar>
        </div>
        <br>
      </div>

      <!-- Bouton de fermeture de la modal pop-up ou lancement du téléchargement -->
      <div class="modal-footer" id="choicePopup">
        <button type="submit" class="btn btn-danger" data-dismiss="modal" (click)="c('Close click')">Fermer</button>
        <button [disabled]="!modalForm.valid" id="widthButton" type="submit" class="btn btn-success" (click)="download()">OK</button>
      </div>
    </ng-template>
  </form>
</div>
